(function(){var t=function(t,i){return function(){return t.apply(i,arguments)}},i={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)i.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};this.Gmaps.Google.Builders.Marker=function(i){function r(i,n,r){this.args=i,this.provider_options=null!=n?n:{},this.internal_options=null!=r?r:{},this.infowindow_binding=t(this.infowindow_binding,this),this.before_init(),this.create_marker(),this.create_infowindow(),this.after_init()}return n(r,i),r.CURRENT_INFOWINDOW=void 0,r.CACHE_STORE={},r.prototype.build=function(){return new(this.model_class())(this.serviceObject,this.infowindow)},r.prototype.create_marker=function(){return this.serviceObject=new(this.primitives().marker)(this.marker_options())},r.prototype.create_infowindow=function(){return _.isString(this.args.infowindow)?(this.infowindow=new(this.primitives().infowindow)({content:this.args.infowindow}),this.bind_infowindow()):null},r.prototype.marker_options=function(){var t,i;return i=this._randomized_coordinates(),t={title:this.args.marker_title,position:new(this.primitives().latLng)(i[0],i[1]),icon:this._get_picture("picture"),shadow:this._get_picture("shadow")},_.extend(this.provider_options,t)},r.prototype.bind_infowindow=function(){return this.addListener("click",this.infowindow_binding)},r.prototype.infowindow_binding=function(){return this.panTo(),this._should_close_infowindow()&&this.constructor.CURRENT_INFOWINDOW.close(),this.infowindow.open(this.getServiceObject().getMap(),this.getServiceObject()),this.constructor.CURRENT_INFOWINDOW=this.infowindow},r.prototype.panTo=function(){return this.getServiceObject().getMap().panTo(this.getServiceObject().getPosition())},r.prototype._get_picture=function(t){return _.isObject(this.args[t])&&_.isString(this.args[t].url)?this._create_or_retrieve_image(this._picture_args(t)):null},r.prototype._create_or_retrieve_image=function(t){return void 0===this.constructor.CACHE_STORE[t.url]&&(this.constructor.CACHE_STORE[t.url]=new(this.primitives().markerImage)(t.url,t.size,t.origin,t.anchor,t.scaledSize)),this.constructor.CACHE_STORE[t.url]},r.prototype._picture_args=function(t){return{url:this.args[t].url,anchor:this._createImageAnchorPosition(this.args[t].anchor),size:new(this.primitives().size)(this.args[t].width,this.args[t].height),scaledSize:null,origin:null}},r.prototype._createImageAnchorPosition=function(t){return _.isArray(t)?new(this.primitives().point)(t[0],t[1]):null},r.prototype._should_close_infowindow=function(){return this.internal_options.singleInfowindow&&null!=this.constructor.CURRENT_INFOWINDOW},r.prototype._randomized_coordinates=function(){var t,i,n,r,o;return _.isNumber(this.internal_options.maxRandomDistance)?(o=function(){return 2*Math.random()-1},n=this.internal_options.maxRandomDistance*o(),r=this.internal_options.maxRandomDistance*o(),t=parseFloat(this.args.lat)+180/Math.PI*(r/6378137),i=parseFloat(this.args.lng)+90/Math.PI*(n/6378137)/Math.cos(this.args.lat),[t,i]):[this.args.lat,this.args.lng]},r}(Gmaps.Objects.BaseBuilder)}).call(this);